/**
 * 
 * 
MemberMouse(TM) (http://www.membermouse.com)
(c) 2010-2011 Pop Fizz Studios, LLC. All rights reserved.
 */
class MM_AuthorizeService extends MM_PaymentService{
	
	protected function saveMember($post){
		$customerFields = new stdClass();
		$customerFields->email = $post["payer_email"];
		$customerFields->product_id = $post["item_number1"];
		$customerFields->first_name = $post["first_name"];
		$customerFields->last_name = $post["last_name"];
		$customerFields->billing_country = "";
		$customerFields->billing_address = "";
		$customerFields->billing_city = "";
		$customerFields->billing_state = "";
		$customerFields->billing_zip = "";
		$customerFields->shipping_country = $post["residence_country"];
		$customerFields->shipping_address = "";
		$customerFields->shipping_city = "";
		$customerFields->shipping_state = "";
		$customerFields->shipping_zip = "";
		$customerFields->payment_id = "";
		$customerFields->order_id = $post["invoice"];
		$customerFields->payment_id = $this->getPaymentId($post["business"]);
		LogMe::write("calling createMember() : ".json_encode($customerFields));
		return $this->createMember($customerFields);
	}
	
	private function getPaymentObj(){
		$authNetOption = MM_Utils::getPaymentMethodObj(new MM_AuthorizeService());
		$tkey = (isset($authNetOption->attr->transkey))?$authNetOption->attr->transkey:"";
		$login = (isset($authNetOption->attr->login))?$authNetOption->attr->login:"";
		return new MM_AuthorizeNet($login,$tkey);
	}
	
	public function viewOrder($id){
		
	}
	
	public function refundOrder($id, $refundAmount){
		
	}
	
	public function fastForwardMembership(MM_Product $product, $price, $days=0){
		
	}
	
	public function changeMembership(MM_User $user, MM_MemberType $crntMemberType, MM_MemberType $newMemberType){
		
	}
	
	public function updateOrderRecurring($orderId, $status, $userId=0){
		
	}
	
	public function handleCallback($request){
		
	}
	
	public function purchaseProduct(MM_User $user, $productId, $initializeNewSubscription=false, $paymentOptionId=0, $shippingOptionId=0, $isFastForward=false){
		
	}
	
	public function placeOrder(MM_Order $order){
//		$authorizeNet = new MM_AuthorizeNet();
//		$this->expirationYear= (strlen($this->expirationYear)==4)?substr($this->expirationYear,2):$this->expirationYear;
// 		$creditInfo = array(
// 			'amount'=>$this->totalCharged,
// 			'first_name'=>$user->getIslFirstName(),
// 			'last_name'=>$user->getIslLastName(),
// 			'address'=>$user->getIslBillingAddress(),
// 			'state'=>$user->getIslBillingState(),
// 			'zip'=>$user->getIslBillingZip(),
// 			'cardNumber'=>$this->cardNumber,
// 			'refId'=>$application,
// 			'expirationDate'=>$this->expirationMonth.$this->expirationYear,
// 		);
//		$resp = array('0');
//		if($plan->getIsRecurring()=="1") // For Recurring
//		{
// 			$creditInfo["totalOccurrences"] = $plan->getDuration();
// 			$creditInfo["unit"] = $plan->getDurationPeriod();
// 			$resp = $authorizeNet->Recurring($creditInfo);	
// 			$parsedResponse = $authorizeNet->parse_return($resp);
// 			
// 			list ($refId, $resultCode, $code, $text, $subscriptionId) =$parsedResponse;
// 			if(strtolower($resultCode)=="ok"){
// 				$resp = array('1'); 
// 				$this->setResponse(json_encode($parsedResponse));
// 				$this->setTransactionId($subscriptionId);
// 				$this->commitData();
// 				return $resp;
// 			}
// 			else{
// 				return $text;
// 			}
//		}
// 		$resp = $authorizeNet->Process($creditInfo);
// 		$this->setResponse(json_encode($resp));	
// 		$this->commitData();
// 		return $resp;
	}
	
	public function placeOrderCardOnFile($previousOrderId, $campaignId, $productId, $shippingId, $userId, $priceOverride="", $initializeNewSubscription=false, $additionalParams=null){
		
	}
	
}