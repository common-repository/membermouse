/**
 * 
 * 
MemberMouse(TM) (http://www.membermouse.com)
(c) 2010-2011 Pop Fizz Studios, LLC. All rights reserved.

Generated class
 */

class MM_VersionRelease extends MM_Entity{
		private $version = "";
		private $notes = "";

		public function getData(){
			global $wpdb;
			$sql = "SELECT * FROM ".MM_TABLE_VERSION_RELEASES." WHERE id='".$this->id."'";
			$result = $wpdb->get_row($sql);

			if($result){
				$this->setData($result);
			}
			else {
				parent::invalidate();
			}
		}

		public function getDataByVersion(){
			global $wpdb;
			$sql = "SELECT * FROM ".MM_TABLE_VERSION_RELEASES." WHERE version='".$this->version."' limit 1";
			$result = $wpdb->get_row($sql);

			if($result){
				$this->id = $result->id;
				$this->setData($result);
			}
			else {
				parent::invalidate();
			}
		}

		public function getFormFields(){
			$info = new stdClass();
			$info->version = $this->version;
			$info->notes = $this->notes;

			return $info;
		}

		public function setData($data){
			try 
			{
				$this->version = $data->version;
				$this->notes = $data->notes;

				parent::validate();
			}
			catch (Exception $ex) {
				parent::invalidate();
			}
		}

		public function commitData(){

			global $wpdb;

			if(intval($this->id)>0){

				$sql = "update ".MM_TABLE_VERSION_RELEASES." set 
					version = '".mysql_escape_string($this->version)."',
					notes = '".mysql_escape_string($this->notes)."',
					date_modified=NOW() 
				where
					id='".$this->id."'";

				$wpdb->query($sql);
				return $this->id;
			}
			else{

				$sql = "insert into ".MM_TABLE_VERSION_RELEASES." set 
					version = '".mysql_escape_string($this->version)."',
					notes = '".mysql_escape_string($this->notes)."',
					date_modified=NOW()";

				$wpdb->query($sql);
				return mysql_insert_id();

			}

			return false;

		}

		public function getVersion(){
			return $this->version;
		}

		public function setVersion($val){
			$this->version = $val;
		}

		public function getNotes(){
			return $this->notes;
		}

		public function setNotes($val){
			$this->notes = $val;
		}

}