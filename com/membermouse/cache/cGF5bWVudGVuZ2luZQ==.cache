/**
 * 
 * 
MemberMouse(TM) (http://www.membermouse.com)
(c) 2010-2011 Pop Fizz Studios, LLC. All rights reserved.
 */
class MM_PaymentEngine{
	public static $MM_PAYMENT_LL = '1';
	public static $MM_PAYMENT_STANDARD = '0';
	
	private $paymentObj;
	
	public function __construct($gatewayId=0){
		if($gatewayId == 0){
			//get limelight by default
			$options = MM_CampaignOptions::getOptions("gateway", false);
			
			if(is_array($options) && count($options)>0){
				foreach($options as $k=>$v){
					if($v == "LimeLight"){
						$gatewayId = 0;
					}
				}
			}
		}
		
		if($gatewayId>0){
			$this->paymentObj = self::getGatewayObject($gatewayId);
		}
		else{
			$this->paymentObj = new MM_LimeLightService();
		}
	}
	
	public static function isLimeLightInstall(){
		$optionValue = MM_OptionUtils::getOption(MM_OptionUtils::$OPTION_KEY_INSTALL_TYPE);
		if($optionValue==self::$MM_PAYMENT_LL || $optionValue===false){
			return true;
		}
		return false;
	}
	
	public static function getGatewayObject($gatewayId){
		$gateway = new MM_CampaignOptions($gatewayId);
		if(!$gateway->isValid()){
			return false;
		}
		
		$attr = $gateway->getAttr();
		$options = json_decode($attr);
		if(is_null($options)){
			return false;
		}
		
		return new $options->hidden_paymentObject();
		
	}
 	
	public function __call($name, $arguments) {
        if(method_exists($this->paymentObj, $name)){
        	$className = get_class($this->paymentObj);
        	
        LogMe::write("PaymentEngine::__call :found class {$className} and function {$name} with arguments: ".json_encode($arguments));
        	return call_user_func_array(array($this->paymentObj,$name), $arguments);
        }
        LogMe::write("PaymentEngine::__call : could not find method {$name}");
		return new MM_Response("Invalid object call", MM_Response::$ERROR);
    }
}